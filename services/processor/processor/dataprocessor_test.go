package processor

import (
	"encoding/json"
	"task/api"
	"testing"
)

func TestProcess(t *testing.T) {

	pr := New()
	_ = pr

	rdJSON := `{
		"status_code": 200,
		"message": "ok",
		"data": {
		   "134": {
			  "1": {
				 "2021-04-24": 101,
				 "2021-04-25": 75,
				 "2021-04-26": 54,
				 "2021-04-27": 79,
				 "2021-04-28": 62,
				 "2021-04-29": 70,
				 "2021-04-30": 78,
				 "2021-05-01": 86,
				 "2021-05-02": 78,
				 "2021-05-03": 55,
				 "2021-05-04": 61,
				 "2021-05-05": 71,
				 "2021-05-06": 76,
				 "2021-05-07": 77,
				 "2021-05-08": 74,
				 "2021-05-09": 68,
				 "2021-05-10": 51,
				 "2021-05-11": 83,
				 "2021-05-12": 73,
				 "2021-05-13": 83,
				 "2021-05-14": 104,
				 "2021-05-15": 84,
				 "2021-05-16": 66,
				 "2021-05-17": 59,
				 "2021-05-18": 68,
				 "2021-05-19": 69,
				 "2021-05-20": 93,
				 "2021-05-21": 103,
				 "2021-05-22": 91,
				 "2021-05-23": 79,
				 "2021-05-24": 71
			  }
		   },
		   "2": {
			  "1": {
				 "2021-04-24": 34,
				 "2021-04-25": 28,
				 "2021-04-26": 22,
				 "2021-04-27": 31,
				 "2021-04-28": 24,
				 "2021-04-29": 25,
				 "2021-04-30": 28,
				 "2021-05-01": 32,
				 "2021-05-02": 32,
				 "2021-05-03": 25,
				 "2021-05-04": 26,
				 "2021-05-05": 28,
				 "2021-05-06": 27,
				 "2021-05-07": 26,
				 "2021-05-08": 24,
				 "2021-05-09": 23,
				 "2021-05-10": 20,
				 "2021-05-11": 31,
				 "2021-05-12": 26,
				 "2021-05-13": 26,
				 "2021-05-14": 35,
				 "2021-05-15": 27,
				 "2021-05-16": 25,
				 "2021-05-17": 23,
				 "2021-05-18": 26,
				 "2021-05-19": 26,
				 "2021-05-20": 34,
				 "2021-05-21": 38,
				 "2021-05-22": 34,
				 "2021-05-23": 34,
				 "2021-05-24": 34
			  }
		   },
		   "23": {
			  "1": {
				 "2021-04-24": 8,
				 "2021-04-25": 8,
				 "2021-04-26": 7,
				 "2021-04-27": 8,
				 "2021-04-28": 6,
				 "2021-04-29": 6,
				 "2021-04-30": 6,
				 "2021-05-01": 5,
				 "2021-05-02": 5,
				 "2021-05-03": 5,
				 "2021-05-04": 5,
				 "2021-05-05": 5,
				 "2021-05-06": 5,
				 "2021-05-07": 5,
				 "2021-05-08": 5,
				 "2021-05-09": 5,
				 "2021-05-10": 5,
				 "2021-05-11": 5,
				 "2021-05-12": 5,
				 "2021-05-13": 5,
				 "2021-05-14": 6,
				 "2021-05-15": 6,
				 "2021-05-16": 6,
				 "2021-05-17": 5,
				 "2021-05-18": 5,
				 "2021-05-19": 5,
				 "2021-05-20": 6,
				 "2021-05-21": 8,
				 "2021-05-22": 6,
				 "2021-05-23": 6,
				 "2021-05-24": 6
			  },
			  "3": {
				 "2021-04-24": 37,
				 "2021-04-25": 36,
				 "2021-04-26": 35,
				 "2021-04-27": 35,
				 "2021-04-28": 36,
				 "2021-04-29": 38,
				 "2021-04-30": 38,
				 "2021-05-01": 40,
				 "2021-05-02": 41,
				 "2021-05-03": 41,
				 "2021-05-04": 42,
				 "2021-05-05": 41,
				 "2021-05-06": 41,
				 "2021-05-07": 42,
				 "2021-05-08": 41,
				 "2021-05-09": 43,
				 "2021-05-10": 43,
				 "2021-05-11": 45,
				 "2021-05-12": 46,
				 "2021-05-13": 45,
				 "2021-05-14": 44,
				 "2021-05-15": 45,
				 "2021-05-16": 47,
				 "2021-05-17": 46,
				 "2021-05-18": 47,
				 "2021-05-19": 47,
				 "2021-05-20": 49,
				 "2021-05-21": 51,
				 "2021-05-22": 52,
				 "2021-05-23": 49,
				 "2021-05-24": 49
			  }
		   }
		}
	 }`

	rd := new(api.RawData)
	err := json.Unmarshal([]byte(rdJSON), rd)
	if err != nil {
		t.Error(err)
	}

	prData, _ := pr.ProcessRawData(rd)

	// spew.Dump(prData)

	if prData["2021-04-24"].Data[134] != 101 {
		t.Errorf("%s %d", "2021-04-24", 134)
	}

	if prData["2021-04-25"].Data[2] != 28 {
		t.Errorf("%s %d", "2021-04-25", 2)
	}

	if prData["2021-04-26"].Data[23] != 7 {
		t.Errorf("%s %d", "2021-04-26", 23)
	}

}
